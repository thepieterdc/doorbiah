var $alertsBox=$("#alerts"),$alertsTitle=$("#alerts-title"),$alertsBody=$("#alerts-body");window.show_alert=function(e,t,i){$alertsTitle.text(e),$alertsBody.text(t),$alertsBox.modal("show"),$alertsBox.on("hidden.bs.modal",function(){void 0!==i&&i()})},$(document).ready(function(){document.addEventListener("keypress",function(e){(27===e.keyCode||13===e.keyCode)&&$alertsBox.modal("hide")},!1)});var $scoreDisplay=$("#score-display"),Branddeur=function(e,t,i,a,n){var d=this;this.RATIO=.89,this.width=Math.ceil(20*Math.random()+46),this.height=this.width/this.RATIO,this.x=t,this.y=i,this.dx=a,this.dy=n,this.loaded=!1,this.image=null,this.out_of_bounds=!1,this.load_image=function(){d.image=new Image,d.image.src="assets/images/brantdeur.png",d.image.onload=function(){d.loaded=!0}},this.updatePosition=function(){d.x+=d.dx,d.y+=d.dy,(d.x<-d.width||d.x>e.width)&&(d.out_of_bounds=!0),(d.y<-d.height||d.y>e.height)&&(d.out_of_bounds=!0)};var h=function(e,t,i,a,n){return e.x+t*e.width>d.x&&e.x+i*e.width<d.x+d.width&&e.y+a*e.height>d.y&&e.y+n*e.height<d.y+d.height};this.collides=function(e){return h(e,.8,.2,1,0)||h(e,.9,.1,.2,.1)||h(e,1,0,.7,.2)},this.load_image()},Head=function(e){var t=this;this.height=60,this.width=49.8,this.x=e.width/2-this.width/2,this.y=e.height/2-this.height/2,this.loaded=!1,this.closed_image=null,this.open_image=null,this.mouth_status=!1,this.DX=4,this.DY=4,this.INACTIVE=0,this.SUPPRESSED=1,this.ACTIVE=2,this.movement={left:this.INACTIVE,right:this.INACTIVE,up:this.INACTIVE,down:this.INACTIVE},this.OPPOSITES={left:"right",right:"left",up:"down",down:"up"},this.getImage=function(){return t.mouth_status?t.open_image:t.closed_image},this.load_images=function(){t.closed_image=new Image,t.closed_image.src="assets/images/tobiah_closed.png",t.closed_image.onload=function(){t.open_image=new Image,t.open_image.src="assets/images/tobiah_open.png",t.open_image.onload=function(){t.loaded=!0}}},this.toggle_mouth=function(e){t.mouth_status=e},this.activateDirection=function(e){this.movement[e]=this.ACTIVE;var t=this.OPPOSITES[e];this.movement[t]===this.ACTIVE&&(this.movement[t]=this.SUPPRESSED)},this.deactivateDirection=function(e){this.movement[e]=this.INACTIVE;var t=this.OPPOSITES[e];this.movement[t]===this.SUPPRESSED&&(this.movement[t]=this.ACTIVE)},this.updatePosition=function(){var i,a;this.movement.left===this.ACTIVE?i=-this.DX:this.movement.right===this.ACTIVE&&(i=this.DX),t.x+i>0&&t.x+i+t.width<e.width&&(t.x+=i),this.movement.up===this.ACTIVE?a=-this.DY:this.movement.down===this.ACTIVE&&(a=this.DY),t.y+a>0&&t.y+a+t.height<e.height&&(t.y+=a)},this.load_images()},Game=function(e,t,i){var a=this;this.canvas=e,this.ctx=t,this.score=0,this.lives=2,this.head=new Head(e),this.herexamen=!1,this.paused=!1,this.branddeuren=[],this.branddeur_counter=60,this.started=!1,this.startScreenImageLoaded=!1,this.startScreenImage=new Image,this.startScreenImage.src="assets/images/startscreen.png",this.startScreenImage.onload=function(){a.startScreenImageLoaded=!0},this.addBranddeur=function(){var t,i,n,d;if(0===a.branddeur_counter){for(t=Math.random()>.5?0:e.width,i=Math.random()>.5?0:e.height,n=0,d=0;0===n&&0===d;)n=6*Math.random()*(0===t?1:-1),d=6*Math.random()*(0===i?1:-1);a.branddeuren.push(new Branddeur(e,t,i,n,d)),a.branddeur_counter=60}else a.branddeur_counter--},this.drawBranddeuren=function(){a.branddeuren.forEach(function(e){e.loaded&&a.ctx.drawImage(e.image,e.x,e.y,e.width,e.height)})},this.drawHead=function(){a.head.loaded&&a.ctx.drawImage(a.head.getImage(),a.head.x,a.head.y,a.head.width,a.head.height)},this.drawStartScreen=function(){a.startScreenImageLoaded&&a.ctx.drawImage(a.startScreenImage,0,0,e.width,e.height)},this.keyDownHandler=function(e){32===e.keyCode&&(a.started?a.head.toggle_mouth(!0):a.started=!0),37===e.keyCode&&a.head.activateDirection("left"),38===e.keyCode&&a.head.activateDirection("up"),39===e.keyCode&&a.head.activateDirection("right"),40===e.keyCode&&a.head.activateDirection("down")},this.keyUpHandler=function(e){32===e.keyCode&&a.head.toggle_mouth(!1),37===e.keyCode&&a.head.deactivateDirection("left"),38===e.keyCode&&a.head.deactivateDirection("up"),39===e.keyCode&&a.head.deactivateDirection("right"),40===e.keyCode&&a.head.deactivateDirection("down")},this.updateBranddeuren=function(){for(var e=a.branddeuren.length-1;e>=0;e--){var t=a.branddeuren[e];t.out_of_bounds?a.branddeuren.splice(e,1):t.updatePosition()}},this.updateHead=function(){a.head.updatePosition()},this.updateScore=function(){a.score+=.03,0!==a.score?a.herexamen?$scoreDisplay.text(Math.ceil(a.score)+"/"+Math.ceil(1.42857143*a.score)+" (= 14/20)"):$scoreDisplay.text(Math.ceil(a.score)+"/"+10*Math.ceil(a.score)+" (= 2/20)"):a.herexamen?$scoreDisplay.text("14/20"):$scoreDisplay.text("2/20")},this.checkCollision=function(){a.branddeuren.forEach(function(e){return e.collides(a.head)&&a.gameOver()})},this.gameOver=function(){a.paused=!0,a.lives--,1===a.lives?(show_alert("Gebuisd!","Je hebt gefaalt. Maar geen nood, je krijgt nog een herkansing. Het herexamen begint nu.",function(){a.paused=!1}),a.herexamen=!0,a.branddeuren.length=0):0===a.lives&&(show_alert("Game over.","Ja, kijk euh … ge hebt het, of ge hebt het niet, éh. En gij hebt het duidelijk niet. Vakken meenemen, daar doet Tobiah niet aan mee."),void 0!==i&&i())},this.draw=function(){a.ctx.clearRect(0,0,a.canvas.width,a.canvas.height),a.started?(a.paused||(a.addBranddeur(),a.updateHead(),a.updateBranddeuren(),a.checkCollision(),a.updateScore(),a.drawBranddeuren()),a.drawHead()):a.drawStartScreen(),requestAnimationFrame(a.draw)}};window.Game=Game,$(document).ready(function(){var e=$("#creditspanel"),t=$("#playpanel"),i=$("#gamepanel")[0],a=$("#gamepanel-container")[0],n=i.getContext("2d");n.imageSmoothingEnabled=!0,i.width=a.offsetWidth,i.height=a.offsetWidth/2;var d=new Game(i,n,function(){document.removeEventListener("keydown",d.keyDownHandler,!1),document.removeEventListener("keyup",d.keyUpHandler,!1),d=null,t.slideUp(500,function(){e.slideDown(500)})});document.addEventListener("keydown",d.keyDownHandler,!1),document.addEventListener("keyup",d.keyUpHandler,!1),d.draw()});